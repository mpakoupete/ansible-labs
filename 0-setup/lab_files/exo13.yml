---
 - hosts : all
   become : yes

   vars_files :
    - secret.yml
    - liste_utilisateurs.yml

   tasks :
    - name : Création des utilisateurs sur Web_servers
      user : 
        name : "{{ item.username }}"
        uid : "{{ item.uid }}"
        password : "{{ user_passwd | password_hash('sha512') }}"
      with_items :
        - "{{ users }}"
      when :
        - inventory_hostname in groups['web_servers'] and item.uid|int < 3000
      
    - name : Création des utilisateurs sur db_servers
      user : 
        name : "{{ item.username }}"
        uid : "{{ item.uid }}"
        password : "{{ user_passwd | password_hash('sha512') }}"
      with_items :
        - "{{ users }}"
      when :
        - inventory_hostname in groups['db_servers'] and item.uid|int > 2999
  
